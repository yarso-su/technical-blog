---
import '@/styles/global.css'
import type { ImageMetadata } from 'astro'
import coverImage from '@/assets/images/cover.jpg'
import { getImage } from 'astro:assets'

export interface Props {
  title: string
  description: string
  image?: ImageMetadata
  noindex?: boolean
  post?: {
    title: string
    published: string
    modified: string
  }
}

const { title, description, image, noindex = false, post } = Astro.props
const imageToUse = image || coverImage

const cover = await getImage({
  src: imageToUse,
  width: 1200,
  height: 630,
  format: 'webp'
})

const canonical = new URL(Astro.url.pathname, Astro.site).href
---

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<link rel="icon" type="image/svg+xml" href="/favicon.svg" />

<link rel="icon" type="image/x-icon" href="/favicon.ico">

<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="Blog. Yarso" />

<link rel="manifest" href="/site.webmanifest" />

<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />
{noindex && <meta name="robots" content="noindex, follow" />}

<link rel="canonical" href={canonical} />
<link rel="sitemap" href="/sitemap-index.xml" />

<meta property="og:type" content="website" />
<meta property="og:url" content={canonical} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={new URL(cover.src, Astro.site)} />

<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:site" content="@yeremi_rrios" />
<meta property="twitter:creator" content="@yeremi_rrios" />
<meta property="twitter:url" content={Astro.url} />
<meta property="twitter:title" content={title} />
<meta property="twitter:description" content={description} />
<meta property="twitter:image" content={new URL(cover.src, Astro.site)} />

{post === undefined && (
  <script is:inline type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Blog",
      "@id": "https://es.yarso.dev",
      "name": "Blog. Yarso",
      "url": "https://es.yarso.dev",
      "description": "Blog personal sobre desarrollo de software y tecnologÃ­a",
      "author": {
        "@id": "https://yarso.dev"
      }
    },
    {
      "@type": "Person",
      "@id": "https://yarso.dev",
      "name": "Yarso",
      "url": "https://yarso.dev",
      "jobTitle": "Software Developer",
      "knowsLanguage": ["es", "en"]
    }
  ]
})}>
  </script>
)}

{post !== undefined && (
  <>
    <meta property="article:published_time" content={post.published}>
    <meta property="article:author" content="Yarso">

    <script is:inline type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": post.title,
      "datePublished": post.published,
      "dateModified": post.modified,
      "author": {
        "@type": "Person", 
        "name": "Yarso"
      }
    })}>
    </script>
  </>
)}


<script is:inline>
  const theme = (() => {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme')
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark'
    }
    return 'light'
  })()

  if (theme === 'light') {
    document.documentElement.classList.remove('dark')
  } else {
    document.documentElement.classList.add('dark')
  }
</script>
